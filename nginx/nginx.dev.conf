# -----------------------------------------------------------
# üåê Nginx ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è DEV –æ–∫—Ä—É–∂–µ–Ω–∏—è (mark-inc)
# -----------------------------------------------------------
# –¶–µ–ª—å: –æ–±—ä–µ–¥–∏–Ω–∏—Ç—å frontend (Next.js) –∏ backend (Express)
# —á–µ—Ä–µ–∑ –µ–¥–∏–Ω—ã–π –ø—Ä–æ–∫—Å–∏ http://localhost.
#
# –¶–µ–ø–æ—á–∫–∞: browser ‚Üí nginx(80) ‚Üí client(3000) ‚Üí server(4000)
#
# –í –ø—Ä–æ–¥–∞–∫—à–Ω–µ –±—É–¥–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥ (nginx.prod.conf),
# –≥–¥–µ –¥–æ–±–∞–≤—è—Ç—Å—è SSL, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–∂–∞—Ç–∏–µ.
# -----------------------------------------------------------

events {}

http {
    # -------------------------------------------------------
    # üß© –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
    # -------------------------------------------------------
    server {
        listen 80;                  # —Å–ª—É—à–∞–µ–º –ø–æ—Ä—Ç 80 (HTTP)
        server_name localhost;      # –¥–æ—Å—Ç—É–ø –ø–æ http://localhost

        # ---------------------------------------------------
        # ‚öôÔ∏è API ‚Äî –ø—Ä–æ–∫—Å–∏—Ä—É–µ–º –Ω–∞ Express backend
        # ---------------------------------------------------
        # –í–∞–∂–Ω–æ: –∑–∞–≤–µ—Ä—à–∞—é—â–∏–π —Å–ª—ç—à "/" –≤ proxy_pass –æ–±—Ä–µ–∑–∞–µ—Ç /api –ø—Ä–µ—Ñ–∏–∫—Å.
        # –ü—Ä–∏–º–µ—Ä:
        #   /api/categories ‚Üí server:4000/categories
        location /api/ {
            proxy_pass http://server:4000/;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }

        # ---------------------------------------------------
        # üîÅ HMR (Hot Module Reload) –¥–ª—è Next.js –≤ DEV —Ä–µ–∂–∏–º–µ
        # ---------------------------------------------------
        # –≠—Ç–æ—Ç –±–ª–æ–∫ –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —á–µ—Ä–µ–∑ `next dev`
        # –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
        # –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–æ–¥–∞ —Ñ—Ä–æ–Ω—Ç–∞.
        location /_next/webpack-hmr/ {
            proxy_pass http://client:3000;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "Upgrade";
            proxy_set_header Host $host;
        }

        # ---------------------------------------------------
        # üíª Frontend ‚Äî –ø—Ä–æ–∫—Å–∏—Ä—É–µ–º –≤–µ—Å—å –æ—Å—Ç–∞–ª—å–Ω–æ–π —Ç—Ä–∞—Ñ–∏–∫
        # ---------------------------------------------------
        # –í dev —Ä–µ–∂–∏–º–µ –∫–ª–∏–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ next dev (–ø–æ—Ä—Ç 3000)
        # –∏ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ –ª–µ—Ç—É. –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ /api –Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç—É–¥–∞.
        location / {
            proxy_pass http://client:3000;
            proxy_http_version 1.1;
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
        }
    }
}

# -----------------------------------------------------------
# ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞:
#   - http://localhost ‚Üí —Ñ—Ä–æ–Ω—Ç
#   - http://localhost/api/hello ‚Üí {"message":"Hello from mark-inc server"}
#
# üîß –ü–æ–¥—Å–∫–∞–∑–∫–∏:
#   - –ï—Å–ª–∏ HMR –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí —É–±–µ–¥–∏—Å—å, —á—Ç–æ Next —Å–ª—É—à–∞–µ—Ç 0.0.0.0
#     (–≤ package.json ‚Üí "dev": "next dev -H 0.0.0.0 -p 3000")
#   - –ï—Å–ª–∏ frontend –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è ‚Üí –ø—Ä–æ–≤–µ—Ä—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ client
#     –∏ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ markinc_client.
#
# üì¶ –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
#   - –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è nginx.prod.conf —Å SSL, gzip –∏ –∫—ç—à–µ–º.
#   - client –±—É–¥–µ—Ç —Å–æ–±—Ä–∞–Ω —á–µ—Ä–µ–∑ next build –∏ —Ä–∞–±–æ—Ç–∞—Ç—å –≤ —Ä–µ–∂–∏–º–µ static.
# -----------------------------------------------------------
